<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Military Network Verification</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body{
    margin:0;
    font-family:Arial;
    background:#050814;
    color:#00ff99;
    overflow:hidden;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
}

/* GRID */
.grid{
    position:fixed;
    width:100%;
    height:100%;
    background:
    linear-gradient(rgba(0,255,150,0.05) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0,255,150,0.05) 1px, transparent 1px);
    background-size:40px 40px;
    animation:gridMove 20s linear infinite;
    z-index:-3;
}
@keyframes gridMove{
    from{background-position:0 0;}
    to{background-position:0 40px;}
}

/* RADAR */
.radar{
    position:fixed;
    width:600px;
    height:600px;
    border-radius:50%;
    background:conic-gradient(rgba(0,255,150,0.25), transparent 60%);
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    animation:spin 6s linear infinite;
    filter:blur(40px);
    z-index:-2;
}
@keyframes spin{
    from{transform:translate(-50%,-50%) rotate(0deg);}
    to{transform:translate(-50%,-50%) rotate(360deg);}
}

/* CARD */
.card{
    width:90%;
    max-width:400px;
    background:rgba(0,0,0,0.6);
    border:1px solid #00ff99;
    border-radius:15px;
    padding:25px;
    text-align:center;
}

.progress{
    width:0%;
    height:6px;
    background:#00ff99;
    transition:width 0.4s;
}

.progress-container{
    width:100%;
    background:#111;
    margin-top:20px;
}

button{
    margin-top:20px;
    padding:10px;
    width:100%;
    background:#00ff99;
    border:none;
    font-weight:bold;
    display:none;
}
.status{
    margin-top:10px;
    font-size:13px;
}
</style>
</head>

<body>

<div class="grid"></div>
<div class="radar"></div>

<div class="card">
    <h3 id="title">SECURITY SCAN INITIALIZING</h3>
    <div class="progress-container">
        <div class="progress" id="progress"></div>
    </div>
    <div class="status" id="status">Security Level: Military Grade</div>
    <button id="continueBtn">CONTINUE</button>
</div>

<script>
let tg = window.Telegram.WebApp;
tg.expand();

let progress = document.getElementById("progress");
let value = 0;

let scan = setInterval(()=>{
    value += 10;
    progress.style.width = value + "%";
    if(value >= 100){
        clearInterval(scan);
        completeVerification();
    }
},400);

async function completeVerification(){

    const fingerprint = btoa(
        navigator.userAgent +
        navigator.language +
        screen.width +
        screen.height
    );

    const response = await fetch("/api/verify", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify({
            initData: tg.initData,
            fingerprint: fingerprint
        })
    });

    const data = await response.json();

    if(data.status === "verified_first_time" || data.status === "verified"){
        document.getElementById("title").innerText = "ACCESS GRANTED";
        document.getElementById("continueBtn").style.display = "block";
    } else {
        document.getElementById("title").innerText = "DEVICE PERMANENTLY LOCKED";
    }
}

document.getElementById("continueBtn").onclick = function(){
    tg.close();
}
</script>

</body>
  </html>
